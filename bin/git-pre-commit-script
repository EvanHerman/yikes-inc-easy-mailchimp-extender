#!/bin/bash

if REV=$(git rev-parse -q --verify HEAD); then
	against=HEAD
else
	# Initial commit: diff against an empty tree object
	against=a64b5adf274cd5c28236ecb10df23814567ef4d2
fi

FILES=$(git diff-index --name-only --cached --diff-filter=ACMR $against -- | grep .php )

if [ "$FILES" == "" ]; then
	echo "No files to check with PHPCS."
	exit 0
fi

set -ex

{{PHPCS_BIN}} -s $FILES